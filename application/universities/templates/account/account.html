{% extends 'universities/layout.html' %}

{% block title %} Увійти в аккаунт | MARCI {% endblock %}
{% block content %}
    <div class="">
        <div class="w-full flex flex-col p-15">
            <h1 class="text-4xl font-bold mb-3">Привіт {{ request.session.student_name }},</h1>
            <h1 class="text-3xl">Ласкаво просимо</h1>
        </div>
        <div class="w-full tabs tabs-lift">
          <input style="" type="radio" name="my_tabs_3" class="tab ml-12" aria-label="Про мене" checked="checked"/>
          <div class="tab-content bg-base-100 border-base-300 p-6">

          </div>

          <input type="radio" name="my_tabs_3" class="tab" aria-label="Вам сподобалось" />
          <div class="tab-content bg-base-100 border-base-300 p-6">
              {%  for faculty in faculties %}
                  {% if faculty.id in saved_faculty_ids %}
                  <div class="card w-full bg-base-100 card-md shadow-sm border ml-4 mr-4">
                      <a class="inline-block" href="{% url 'university_view' faculty.id %}">
                          <div class="flex flex-row justify-between card-body items-center">
                              <div class="">
                                  <h2 class="card-title">{{ faculty.university_name }}</h2>
                                  <p>{{ faculty.faculty_name }}</p>
                                  <p>{{ faculty.region }}</p>
                                </div>
                                <div>
                                    <form method="POST" class="heard_form" id="form-{{ faculty.id }}">
                                        {% csrf_token %}
                                        <input type="hidden" name="faculty_id" value="{{ faculty.id }}"/>
                                        <input type="checkbox"
                                               class="heard_checkbox hidden peer checkbox-trigger"
                                               data-id="{{ faculty.id }}"
                                               data-checked="{{ faculty.is_saved|yesno:'true,false' }}"
                                               id="heart-{{ faculty.id }}"
                                               {% if faculty.id in saved_faculty_ids %}checked{% endif %}
                                        />
                                        <label for="heart-{{ faculty.id }}" class="mask mask-heart w-6 h-6 inline-block cursor-pointer bg-gray-400 peer-checked:bg-red-500 transition-colors duration-300 ease-in-out"></label>
                                    </form>
                                </div>
                            </div>
                        </a>
                    </div>
                  {% endif %}
              {% endfor %}
          </div>

          <input type="radio" name="my_tabs_3" class="tab" aria-label="Вам МОЖЕ сподобатися" />
          <div class="tab-content bg-base-100 border-base-300 p-6">Tab content 3</div>
        </div>
    </div>

    <script>


document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.checkbox-trigger');

    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            const universityId = this.dataset.id;
            const isChecked = this.checked;
            const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

            fetch("{% url 'save_faculty' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    university_id: universityId,
                    is_checked: isChecked
                })
            })
            .then(response => {
                if (!response.ok) throw new Error('Network error');
                return response.json();
            })
            .then(data => {
                console.log('Response:', data);
            })
            .catch(error => {
                console.error('AJAX error:', error);
            });
        });
    });
});
</script>

{% endblock %}
